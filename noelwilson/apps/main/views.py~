from django.http import HttpResponse, HttpResponseRedirect
from django.shortcuts import render_to_response
from django.template import RequestContext
from noelwilson import settings
from noelwilson.apps.data.models import Project, ProjectLists
from noelwilson.apps.flickr.models import Photo, sync_flickr_photos
from django.http import Http404

import os, sys
import datetime

def getDataFile(fileName):
	# get intro text
	filePath = (settings.STATIC_ROOT + "/data/" + fileName)
	if os.path.isfile(filePath):
		File = open(filePath)
		introText = File.read()
		File.close()
	else:
		introText = ''
	return introText

def homepage(request):		
	# get intro text
	introText = getDataFile("introText.html")
	ctx = { 'introText':introText}
	return render_to_response('home.html', ctx , context_instance= RequestContext(request) )
	
def technical(request, projectName=None):
	projects = []
	if projectName == None:
		projectName = "webDev"
	# get contact info
	contactInfo = getDataFile("contactInfo.html")
	# get projects	
	projects = Project.objects.filter(projectList__projectName__contains= projectName )
	for project in projects:
		project.text = getDataFile(project.text)
		project.videoFile = getDataFile(project.videoFile)
	ctx = { 'projects':projects,
			'contactInfo':contactInfo}
	return render_to_response('technical.html', ctx , context_instance= RequestContext(request) )
	
def artwork(request, projectName=None):
	projects = []
	if projectName == None:
		projectName = "3DArtwork"
	print projectName
	# get contact info
	#contactInfo = getDataFile("contactInfo.html")
	# get projects	
	projects = Project.objects.filter(projectList__projectName__contains= projectName )
	for project in projects:
		project.text = getDataFile(project.text)
		project.videoFile = getDataFile(project.videoFile)
	# get most recent artwork pictures
	sync_flickr_photos(album = projectName)
	photos = Photo.objects.filter(album__name__contains= projectName )
	# get gallery type
	if projectName == "2DArtwork":
		galleryType = '2D'
	else:
		galleryType = '3D'
	ctx = { 'projects':projects,
			'photos':photos,
			'galleryType': galleryType,}
	return render_to_response('artwork.html', ctx , context_instance= RequestContext(request) )
	
def training(request, projectName=None):
	projects = []
	if projectName == None:
		projectName = "training"
	# get projects	
	projects = Project.objects.filter(projectList__projectName__contains= projectName )
	for project in projects:
		project.text = getDataFile(project.text)
		project.videoFile = getDataFile(project.videoFile)
	ctx = { 'projects':projects}
	return render_to_response('training.html', ctx , context_instance= RequestContext(request) )

